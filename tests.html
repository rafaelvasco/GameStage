<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Stage AI - Test Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        padding: 30px;
      }

      .test-panel {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .console-panel {
        background: #1e1e1e;
        border-radius: 10px;
        padding: 25px;
        color: #fff;
        font-family: "Courier New", monospace;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .panel-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        color: #333;
        border-bottom: 2px solid #4facfe;
        padding-bottom: 10px;
      }

      .console-title {
        color: #4facfe;
        border-bottom-color: #4facfe;
      }

      .test-grid {
        display: grid;
        gap: 15px;
      }

      .test-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .test-item:hover {
        border-color: #4facfe;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(79, 172, 254, 0.2);
      }

      .test-status {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #ddd;
        border: 2px solid #ccc;
        transition: all 0.3s ease;
      }

      .test-status.pending {
        background: #ffd700;
        border-color: #ffcc00;
        animation: pulse 1.5s infinite;
      }

      .test-status.success {
        background: #44ff44;
        border-color: #22cc22;
      }

      .test-status.error {
        background: #ff4444;
        border-color: #cc2222;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .test-info {
        flex: 1;
      }

      .test-name {
        font-weight: bold;
        margin-bottom: 5px;
        color: #333;
      }

      .test-description {
        font-size: 0.9rem;
        color: #666;
      }

      .test-button {
        padding: 10px 20px;
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .test-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
      }

      .test-button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .control-buttons {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .control-button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .primary-button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .secondary-button {
        background: #f8f9fa;
        color: #333;
        border: 2px solid #dee2e6;
      }

      .control-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .console-output {
        background: #2d2d2d;
        border-radius: 5px;
        padding: 15px;
        height: 400px;
        overflow-y: auto;
        font-size: 0.9rem;
        line-height: 1.4;
        border: 1px solid #444;
      }

      .console-line {
        margin-bottom: 8px;
        white-space: pre-wrap;
      }

      .console-line.info {
        color: #4facfe;
      }
      .console-line.success {
        color: #44ff44;
      }
      .console-line.error {
        color: #ff4444;
      }
      .console-line.warning {
        color: #ffd700;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .stat-number {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #666;
      }

      .stat-card.total .stat-number {
        color: #667eea;
      }
      .stat-card.passed .stat-number {
        color: #44ff44;
      }
      .stat-card.failed .stat-number {
        color: #ff4444;
      }
      .stat-card.running .stat-number {
        color: #ffd700;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #666;
      }

      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2rem;
        }

        .control-buttons {
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üéÆ Game Stage AI</h1>
        <p>Test Dashboard</p>
      </div>

      <div class="main-content">
        <div class="test-panel">
          <h2 class="panel-title">Test Suite</h2>

          <div class="stats">
            <div class="stat-card total">
              <div class="stat-number" id="totalTests">0</div>
              <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat-card passed">
              <div class="stat-number" id="passedTests">0</div>
              <div class="stat-label">Passed</div>
            </div>
            <div class="stat-card failed">
              <div class="stat-number" id="failedTests">0</div>
              <div class="stat-label">Failed</div>
            </div>
            <div class="stat-card running">
              <div class="stat-number" id="runningTests">0</div>
              <div class="stat-label">Running</div>
            </div>
          </div>

          <div class="control-buttons">
            <button
              class="control-button primary-button"
              onclick="runAllTests()"
            >
              üöÄ Run All Tests
            </button>
            <button
              class="control-button secondary-button"
              onclick="clearConsole()"
            >
              üóëÔ∏è Clear Console
            </button>
          </div>

          <div class="test-grid" id="testGrid">
            <div class="loading">Loading tests...</div>
          </div>
        </div>

        <div class="console-panel">
          <h2 class="panel-title console-title">Console Output</h2>
          <div class="console-output" id="consoleOutput">
            <div class="console-line info">
              Welcome to Game Stage AI Test Dashboard! üéÆ
            </div>
            <div class="console-line">
              Ready to run tests. Click on individual test buttons or "Run All
              Tests" to get started.
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import {
        runAllTests,
        runTest,
        getPrimaryTests,
      } from "./src/test/test-runner.ts";

      // Make functions available globally
      window.runAllTestsFromModule = runAllTests;
      window.runTestFromModule = runTest;

      // Test state management
      let testStats = {
        total: 0,
        passed: 0,
        failed: 0,
        running: 0,
      };

      let availableTests = [];

      // Initialize the test dashboard
      async function initializeDashboard() {
        try {
          // Get available tests from the test runner
          availableTests = getPrimaryTests();
          testStats.total = availableTests.length;

          // Generate test grid
          generateTestGrid();

          // Update stats display
          updateStats();

          logToConsole(
            "Test dashboard initialized. Ready to run tests!",
            "success"
          );
        } catch (error) {
          logToConsole(
            `Failed to initialize dashboard: ${error.message}`,
            "error"
          );
          console.error(error);
        }
      }

      // Generate the test grid dynamically
      function generateTestGrid() {
        const testGrid = document.getElementById("testGrid");
        testGrid.innerHTML = "";

        availableTests.forEach((test) => {
          const testItem = document.createElement("div");
          testItem.className = "test-item";
          testItem.setAttribute("data-test", test.id);

          testItem.innerHTML = `
            <div class="test-status" id="status-${test.id}"></div>
            <div class="test-info">
              <div class="test-name">${test.icon} ${test.name}</div>
              <div class="test-description">${test.description}</div>
            </div>
            <button class="test-button" onclick="runSingleTest('${test.id}')">
              Run
            </button>
          `;

          testGrid.appendChild(testItem);
        });
      }

      // Update stats display
      function updateStats() {
        document.getElementById("totalTests").textContent = testStats.total;
        document.getElementById("passedTests").textContent = testStats.passed;
        document.getElementById("failedTests").textContent = testStats.failed;
        document.getElementById("runningTests").textContent = testStats.running;
      }

      // Log to console
      function logToConsole(message, type = "info") {
        const console = document.getElementById("consoleOutput");
        const line = document.createElement("div");
        line.className = `console-line ${type}`;
        line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        console.appendChild(line);
        console.scrollTop = console.scrollHeight;
      }

      // Set test status
      function setTestStatus(testName, status) {
        const statusElement = document.getElementById(`status-${testName}`);
        if (statusElement) {
          statusElement.className = `test-status ${status}`;
        }
      }

      // Clear console
      window.clearConsole = function () {
        document.getElementById("consoleOutput").innerHTML = "";
        logToConsole("Console cleared", "info");
      };

      // Run all tests
      window.runAllTests = async function () {
        logToConsole("üöÄ Starting full test suite...", "info");

        // Reset stats
        testStats.passed = 0;
        testStats.failed = 0;
        testStats.running = 1;
        updateStats();

        // Reset all test statuses
        availableTests.forEach((test) => setTestStatus(test.id, ""));

        try {
          // Capture console output
          const originalConsole = window.console;
          const originalLog = originalConsole.log;
          const originalError = originalConsole.error;
          const originalInfo = originalConsole.info;

          // Override console methods to capture output
          window.console.log = (...args) => {
            logToConsole(args.join(" "), "info");
            originalLog.apply(originalConsole, args);
          };

          window.console.error = (...args) => {
            logToConsole(args.join(" "), "error");
            originalError.apply(originalConsole, args);
          };

          window.console.info = (...args) => {
            logToConsole(args.join(" "), "info");
            originalInfo.apply(originalConsole, args);
          };

          await window.runAllTestsFromModule();

          // Restore console
          window.console.log = originalLog;
          window.console.error = originalError;
          window.console.info = originalInfo;

          testStats.running = 0;
          testStats.passed = testStats.total;
          updateStats();

          // Set all tests as success
          availableTests.forEach((test) => setTestStatus(test.id, "success"));

          logToConsole("‚úÖ All tests completed successfully!", "success");
        } catch (error) {
          testStats.running = 0;
          testStats.failed = 1;
          updateStats();

          logToConsole(`‚ùå Test suite failed: ${error.message}`, "error");
          console.error(error);
        }
      };

      // Run single test
      window.runSingleTest = async function (testName) {
        logToConsole(`üîç Running ${testName} test...`, "info");

        setTestStatus(testName, "pending");
        testStats.running++;
        updateStats();

        try {
          // Capture console output for this test
          const originalConsole = window.console;
          const originalLog = originalConsole.log;
          const originalError = originalConsole.error;

          window.console.log = (...args) => {
            logToConsole(args.join(" "), "info");
            originalLog.apply(originalConsole, args);
          };

          window.console.error = (...args) => {
            logToConsole(args.join(" "), "error");
            originalError.apply(originalConsole, args);
          };

          await window.runTestFromModule(testName);

          // Restore console
          window.console.log = originalLog;
          window.console.error = originalError;

          setTestStatus(testName, "success");
          testStats.running--;
          testStats.passed++;
          updateStats();

          logToConsole(
            `‚úÖ ${testName} test completed successfully!`,
            "success"
          );
        } catch (error) {
          setTestStatus(testName, "error");
          testStats.running--;
          testStats.failed++;
          updateStats();

          logToConsole(`‚ùå ${testName} test failed: ${error.message}`, "error");
          console.error(error);
        }
      };

      // Initialize dashboard when page loads
      initializeDashboard();
    </script>
  </body>
</html>
